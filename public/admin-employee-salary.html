<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Salary Details - Shree Mata Admin</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/admin-nav.css">
    <style>
        .salary-details {
            padding: 20px;
            background: #f8f9fa;
            min-height: 100vh;
        }

        .employee-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .employee-header h1 {
            margin: 0 0 10px 0;
            font-size: 2rem;
        }

        .employee-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .info-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
        }

        .info-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .summary-card .icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .summary-card .value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .summary-card .label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .card-total { border-left: 5px solid #007bff; }
        .card-total .icon { color: #007bff; }
        .card-total .value { color: #007bff; }

        .card-pending { border-left: 5px solid #ffc107; }
        .card-pending .icon { color: #ffc107; }
        .card-pending .value { color: #ffc107; }

        .card-records { border-left: 5px solid #28a745; }
        .card-records .icon { color: #28a745; }
        .card-records .value { color: #28a745; }

        .controls-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-right: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: white;
        }

        .salary-table {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-header {
            background: linear-gradient(135deg, #495057 0%, #6c757d 100%);
            color: white;
            padding: 20px;
        }

        .table-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }

        .table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }

        .records-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .records-table th {
            background: #f8f9fa;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .records-table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
            vertical-align: middle;
        }

        .records-table tbody tr:hover {
            background: #f8f9fa;
        }

        .payment-status {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .payment-paid { background: #d4edda; color: #155724; }
        .payment-pending { background: #fff3cd; color: #856404; }
        .payment-cancelled { background: #f8d7da; color: #721c24; }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-daily { background: #fff3cd; color: #856404; }
        .status-weekly { background: #d4edda; color: #155724; }
        .status-monthly { background: #cce5ff; color: #004085; }
        .status-yearly { background: #e2e3e5; color: #383d41; }
        .status-project { background: #f8d7da; color: #721c24; }
        .status-hourly { background: #d1ecf1; color: #0c5460; }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
            border-radius: 6px;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
            border: none;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            border: none;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 25px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h4 {
            margin: 0;
            font-size: 1.3rem;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .modal-body {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .otp-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
        }

        .otp-input {
            font-size: 1.5rem;
            text-align: center;
            letter-spacing: 5px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            max-width: 200px;
            margin-left: auto;
            margin-right: auto;
        }

        @media (max-width: 768px) {
            .employee-info {
                grid-template-columns: 1fr;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                margin: 2% auto;
            }
        }
    </style>
</head>
<body>
    <div id="admin-nav-placeholder"></div>

    <div class="salary-details">
        <!-- Employee Header -->
        <div class="employee-header">
            <h1 id="employeeName">Loading...</h1>
            <div class="employee-info" id="employeeInfo">
                <!-- Employee details will be loaded here -->
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="summary-cards">
            <div class="summary-card card-total">
                <div class="icon">üí∞</div>
                <div class="value" id="totalPaid">‚Çπ-</div>
                <div class="label">Total Paid</div>
            </div>
            <div class="summary-card card-pending">
                <div class="icon">‚è≥</div>
                <div class="value" id="totalPending">‚Çπ-</div>
                <div class="label">Pending Amount</div>
            </div>
            <div class="summary-card card-records">
                <div class="icon">üìä</div>
                <div class="value" id="totalRecords">-</div>
                <div class="label">Salary Records</div>
            </div>
        </div>

        <!-- Controls Section -->
        <div class="controls-section">
            <button class="btn btn-success" onclick="showAddSalaryModal()">
                <span>üí∏</span> Add Salary Record
            </button>
            <button class="btn btn-warning" onclick="refreshData()">
                <span>üîÑ</span> Refresh Data
            </button>
            <button class="btn btn-primary" onclick="goBack()">
                <span>‚¨ÖÔ∏è</span> Back to Dashboard
            </button>
        </div>

        <!-- Salary Records Table -->
        <div class="salary-table">
            <div class="table-header">
                <h3>üí∞ Salary Records</h3>
            </div>
            <div class="table-container">
                <table class="records-table">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Period</th>
                            <th>Duration</th>
                            <th>Basic Salary</th>
                            <th>Allowances</th>
                            <th>Bonus</th>
                            <th>Overtime</th>
                            <th>Deductions</th>
                            <th>Total Salary</th>
                            <th>Payment Status</th>
                            <th>Payment Date</th>
                            <th>Payment Method</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="salaryRecordsBody">
                        <tr>
                            <td colspan="11" class="loading">
                                <div class="spinner"></div>
                                Loading salary records...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Update Salary Modal -->
    <div id="updateSalaryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h4>‚úèÔ∏è Update Salary Record</h4>
                <span class="close" onclick="closeModal('updateSalaryModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div id="updateSalaryAlert"></div>
                <form id="updateSalaryForm">
                    <input type="hidden" id="updateSalaryId">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="updatePaymentStatus">Payment Status *</label>
                            <select id="updatePaymentStatus" class="form-control" required>
                                <option value="pending">Pending</option>
                                <option value="paid">Paid</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="updatePaymentMethod">Payment Method</label>
                            <select id="updatePaymentMethod" class="form-control">
                                <option value="bank_transfer">Bank Transfer</option>
                                <option value="cash">Cash</option>
                                <option value="cheque">Cheque</option>
                                <option value="upi">UPI</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="updateNotes">Notes</label>
                        <textarea id="updateNotes" class="form-control" rows="3" placeholder="Optional notes..."></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-success" style="width: 100%;">
                            <span>üí∞</span> Update Salary Record
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- OTP Verification Modal -->
    <div id="otpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h4>üîê OTP Verification Required</h4>
                <span class="close" onclick="closeModal('otpModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div id="otpAlert"></div>
                <div class="otp-section">
                    <p><strong>Security Verification Required</strong></p>
                    <p>An OTP has been sent to the employee's email address for verification.</p>
                    <p>Please ask the employee to provide the 6-digit OTP:</p>
                    <input type="text" id="otpInput" class="form-control otp-input" placeholder="Enter 6-digit OTP" maxlength="6">
                    <div style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="verifyOTP()" style="margin-right: 10px;">
                            <span>‚úÖ</span> Verify OTP
                        </button>
                        <button class="btn btn-secondary" onclick="resendOTP()">
                            <span>üìß</span> Resend OTP
                        </button>
                    </div>
                    <p style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                        OTP expires in 10 minutes. If not received, check spam folder.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="js/admin-navigation.js"></script>
    <script>
        let employeeId = null;
        let employee = null;
        let salaryRecords = [];
        let currentOTPAction = null;
        let currentSalaryId = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Admin navigation is automatically initialized by admin-navigation.js
            
            // Get employee ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            employeeId = urlParams.get('id');
            
            if (!employeeId) {
                alert('Employee ID not provided');
                window.location.href = 'admin-salary-dashboard.html';
                return;
            }
            
            loadEmployeeSalaryData();
        });

        // Load employee salary data
        async function loadEmployeeSalaryData() {
            try {
                const response = await fetch(`/api/employees/${employeeId}/salary`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    employee = data.employee;
                    salaryRecords = data.salaryRecords;
                    
                    renderEmployeeInfo();
                    renderSummaryCards();
                    renderSalaryRecords();
                } else {
                    throw new Error('Failed to load employee salary data');
                }
            } catch (error) {
                console.error('Error loading employee salary data:', error);
                alert('Error loading employee data: ' + error.message);
                window.location.href = 'admin-salary-dashboard.html';
            }
        }

        // Render employee info
        function renderEmployeeInfo() {
            document.getElementById('employeeName').textContent = `${employee.name} (${employee.employeeId})`;
            
            document.getElementById('employeeInfo').innerHTML = `
                <div class="info-item">
                    <div class="info-label">Employee ID</div>
                    <div class="info-value">${employee.employeeId}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Email</div>
                    <div class="info-value">${employee.email}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Total Records</div>
                    <div class="info-value">${salaryRecords.length}</div>
                </div>
            `;
        }

        // Render summary cards
        function renderSummaryCards() {
            const totalPaid = salaryRecords
                .filter(record => record.paymentStatus === 'paid')
                .reduce((sum, record) => sum + record.totalSalary, 0);
            
            const totalPending = salaryRecords
                .filter(record => record.paymentStatus === 'pending')
                .reduce((sum, record) => sum + record.totalSalary, 0);

            document.getElementById('totalPaid').textContent = `‚Çπ${totalPaid.toLocaleString()}`;
            document.getElementById('totalPending').textContent = `‚Çπ${totalPending.toLocaleString()}`;
            document.getElementById('totalRecords').textContent = salaryRecords.length;
        }

        // Render salary records
        function renderSalaryRecords() {
            const tbody = document.getElementById('salaryRecordsBody');
            
            if (salaryRecords.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" style="text-align: center; padding: 40px; color: #666;">
                            üí∞ No salary records found for this employee.
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = salaryRecords.map(record => `
                <tr>
                    <td><span class="status-badge status-${record.salaryType || 'monthly'}">${(record.salaryType || 'monthly').toUpperCase()}</span></td>
                    <td><strong>${record.periodDescription || record.month || 'N/A'}</strong></td>
                    <td>${record.startDate && record.endDate ? 
                        `${new Date(record.startDate).toLocaleDateString()} - ${new Date(record.endDate).toLocaleDateString()}` : 
                        (record.salaryDate ? new Date(record.salaryDate).toLocaleDateString() : 'N/A')}</td>
                    <td>‚Çπ${record.basicSalary.toLocaleString()}</td>
                    <td>‚Çπ${record.allowances.toLocaleString()}</td>
                    <td>‚Çπ${record.bonus.toLocaleString()}</td>
                    <td>‚Çπ${record.overtime.toLocaleString()}</td>
                    <td>‚Çπ${record.deductions.toLocaleString()}</td>
                    <td><strong>‚Çπ${record.totalSalary.toLocaleString()}</strong></td>
                    <td><span class="payment-status payment-${record.paymentStatus}">${record.paymentStatus.toUpperCase()}</span></td>
                    <td>${record.paymentDate ? new Date(record.paymentDate).toLocaleDateString() : '-'}</td>
                    <td>${record.paymentMethod.replace('_', ' ').toUpperCase()}</td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="editSalaryRecord('${record._id}')">
                            ‚úèÔ∏è Edit
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Edit salary record
        function editSalaryRecord(salaryId) {
            const record = salaryRecords.find(r => r._id === salaryId);
            if (!record) return;

            document.getElementById('updateSalaryId').value = salaryId;
            document.getElementById('updatePaymentStatus').value = record.paymentStatus;
            document.getElementById('updatePaymentMethod').value = record.paymentMethod;
            document.getElementById('updateNotes').value = record.notes || '';
            document.getElementById('updateSalaryAlert').innerHTML = '';
            
            document.getElementById('updateSalaryModal').style.display = 'block';
        }

        // Update salary form submission
        document.getElementById('updateSalaryForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const salaryId = document.getElementById('updateSalaryId').value;
            const formData = {
                paymentStatus: document.getElementById('updatePaymentStatus').value,
                paymentMethod: document.getElementById('updatePaymentMethod').value,
                notes: document.getElementById('updateNotes').value
            };

            // Find the current salary record to check if payment status is changing
            const currentRecord = salaryRecords.find(r => r._id === salaryId);
            const isPaymentStatusChange = formData.paymentStatus !== currentRecord.paymentStatus;

            try {
                // First try direct update
                const response = await fetch(`/api/employees/${employeeId}/salary/${salaryId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (response.ok) {
                    document.getElementById('updateSalaryAlert').innerHTML = `
                        <div class="alert alert-success">
                            ‚úÖ Salary record updated successfully!
                        </div>
                    `;
                    
                    setTimeout(() => {
                        closeModal('updateSalaryModal');
                        refreshData();
                    }, 2000);
                } else if (data.requiresOTP) {
                    // Payment status change requires OTP verification
                    currentOTPAction = formData;
                    currentSalaryId = salaryId;
                    
                    // Request OTP
                    await requestOTP(salaryId, formData);
                } else if (data.requiresEmailVerification) {
                    // Employee email is not verified
                    document.getElementById('updateSalaryAlert').innerHTML = `
                        <div class="alert alert-danger">
                            ‚ùå Email Verification Required<br>
                            <small>${data.message}</small>
                        </div>
                    `;
                } else {
                    document.getElementById('updateSalaryAlert').innerHTML = `
                        <div class="alert alert-danger">
                            ‚ùå Error: ${data.error}
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('updateSalaryAlert').innerHTML = `
                    <div class="alert alert-danger">
                        ‚ùå Error updating salary record: ${error.message}
                    </div>
                `;
            }
        });

        // Request OTP for salary update
        async function requestOTP(salaryId, updateData) {
            try {
                const response = await fetch(`/api/employees/${employeeId}/salary/${salaryId}/request-otp`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ updateData })
                });

                const data = await response.json();

                if (response.ok) {
                    // Close update modal and show OTP modal
                    closeModal('updateSalaryModal');
                    document.getElementById('otpModal').style.display = 'block';
                    document.getElementById('otpInput').value = '';
                    document.getElementById('otpAlert').innerHTML = `
                        <div class="alert alert-success">
                            ‚úÖ OTP sent to employee's email address
                        </div>
                    `;
                } else {
                    document.getElementById('updateSalaryAlert').innerHTML = `
                        <div class="alert alert-danger">
                            ‚ùå Error requesting OTP: ${data.error}
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('updateSalaryAlert').innerHTML = `
                    <div class="alert alert-danger">
                        ‚ùå Error requesting OTP: ${error.message}
                    </div>
                `;
            }
        }

        // Verify OTP
        async function verifyOTP() {
            const otp = document.getElementById('otpInput').value.trim();
            
            if (!otp || otp.length !== 6) {
                document.getElementById('otpAlert').innerHTML = `
                    <div class="alert alert-danger">
                        ‚ùå Please enter a valid 6-digit OTP
                    </div>
                `;
                return;
            }

            try {
                const response = await fetch(`/api/employees/${employeeId}/salary/${currentSalaryId}/verify-otp`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ otp })
                });

                const data = await response.json();

                if (response.ok) {
                    document.getElementById('otpAlert').innerHTML = `
                        <div class="alert alert-success">
                            ‚úÖ OTP verified successfully! Salary record updated.
                        </div>
                    `;
                    
                    setTimeout(() => {
                        closeModal('otpModal');
                        refreshData();
                        currentOTPAction = null;
                        currentSalaryId = null;
                    }, 2000);
                } else {
                    document.getElementById('otpAlert').innerHTML = `
                        <div class="alert alert-danger">
                            ‚ùå ${data.error}
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('otpAlert').innerHTML = `
                    <div class="alert alert-danger">
                        ‚ùå Error verifying OTP: ${error.message}
                    </div>
                `;
            }
        }

        // Resend OTP
        async function resendOTP() {
            if (!currentSalaryId || !currentOTPAction) {
                document.getElementById('otpAlert').innerHTML = `
                    <div class="alert alert-danger">
                        ‚ùå No pending OTP request found
                    </div>
                `;
                return;
            }

            await requestOTP(currentSalaryId, currentOTPAction);
        }

        // Show add salary modal
        function showAddSalaryModal() {
            window.location.href = `admin-salary-dashboard.html?addSalary=${employeeId}`;
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Refresh data
        function refreshData() {
            loadEmployeeSalaryData();
        }

        // Go back to dashboard
        function goBack() {
            window.location.href = 'admin-salary-dashboard.html';
        }

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            const modals = ['updateSalaryModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    closeModal(modalId);
                }
            });
        });
    </script>
</body>
</html>