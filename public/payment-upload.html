<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Payment Details - Shree Mata</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .upload-container {
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .upload-header {
            margin-bottom: 30px;
        }
        
        .upload-header h1 {
            color: #28a745;
            margin-bottom: 10px;
        }
        
        .order-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        
        .form-links {
            display: flex;
            gap: 20px;
            margin: 30px 0;
        }
        
        .form-link {
            flex: 1;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            transition: transform 0.3s;
        }
        
        .form-link:hover {
            transform: translateY(-2px);
            color: white;
        }
        
        .instructions {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        
        @media (max-width: 600px) {
            .form-links {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="upload-container">
        <div class="upload-header">
            <h1>üìã Upload Payment Details</h1>
            <p>Your order has been created successfully!</p>
        </div>
        
        <div class="order-info" id="orderInfo">
            <h3>Order Details</h3>
            <p><strong>Order ID:</strong> <span id="orderId">Loading...</span></p>
            <p><strong>Amount:</strong> ‚Çπ<span id="orderAmount">Loading...</span></p>
            <p><strong>Payment Type:</strong> <span id="paymentType">Loading...</span></p>
        </div>
        
        <div class="instructions">
            <h4>üìù Next Steps:</h4>
            <ol>
                <li>Click the appropriate form link below</li>
                <li>Fill in all required details</li>
                <li>Upload clear images of your payment proof</li>
                <li>Submit the form</li>
                <li><strong>After submission, you'll be redirected back to your orders page</strong></li>
                <li>Later, add UTR number in "My Orders" when payment clears</li>
                <li>Wait for admin verification (1-2 business days)</li>
            </ol>
        </div>
        
        <div class="form-links">
            <a href="#" id="chequeFormLink" class="form-link" style="display: none;" onclick="openPaymentForm('cheque')">
                <h4>üìù Cheque Payment Form</h4>
                <p>Upload cheque images & details</p>
            </a>
            
            <a href="#" id="transferFormLink" class="form-link" style="display: none;" onclick="openPaymentForm('transfer')">
                <h4>üè¶ Bank Transfer Form</h4>
                <p>Upload transfer receipt & UTR</p>
            </a>
        </div>
        
        <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
            <h4 style="margin: 0 0 10px 0; color: #856404;">üí° Important Instructions</h4>
            <ul style="margin: 0; padding-left: 20px; color: #856404;">
                <li>After submitting the form, you'll be redirected back to your orders page</li>
                <li>You can add UTR number later in "My Orders" section</li>
                <li>Keep your payment receipt safe for verification</li>
            </ul>
        </div>
        
        <div style="margin-top: 30px; text-align: center;">
            <a href="/account.html?section=orders" class="btn-secondary" style="margin: 10px;">
                üì¶ View My Orders
            </a>
            
            <button onclick="redirectToSuccess()" class="btn-primary" style="margin: 10px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border: none; padding: 15px 25px; border-radius: 8px; color: white; cursor: pointer; font-weight: 600;">
                ‚úÖ I Completed the Form - Continue
            </button>
        </div>
    </div>

    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('orderId');
        const amount = urlParams.get('amount');
        const paymentType = urlParams.get('type');
        
        // Get user details from localStorage
        const user = JSON.parse(localStorage.getItem("user") || "{}");
        const userEmail = user.email || '';
        const userName = user.name || '';
        
        // Update page content
        if (orderId) document.getElementById('orderId').textContent = orderId;
        if (amount) document.getElementById('orderAmount').textContent = amount;
        if (paymentType) {
            document.getElementById('paymentType').textContent = 
                paymentType === 'cheque' ? 'Cheque Payment' : 'Bank Transfer';
            
            // Show appropriate form link
            if (paymentType === 'cheque') {
                document.getElementById('chequeFormLink').style.display = 'block';
            } else {
                document.getElementById('transferFormLink').style.display = 'block';
            }
        }
        
        // Function to open payment form
        function openPaymentForm(type) {
            let formUrl = '';
            
            if (type === 'cheque') {
                // Cheque Payment Form (Working with pre-fill)
                formUrl = `https://docs.google.com/forms/d/e/1FAIpQLSdkaIGD87RUORM210G8kCWeIx60Fdc88KKkxcnmuee1bOL2Pg/viewform?usp=pp_url` +
                    `&entry.1788264298=${orderId}` +
                    `&entry.1894225499=${amount}` +
                    `&entry.774046160=${encodeURIComponent(userEmail)}` +
                    `&entry.1406386079=${encodeURIComponent(userName)}` +
                    `&entry.980862279=${encodeURIComponent('Cheque Payment')}` +
                    `&entry.790413540=${new Date().toISOString().split('T')[0]}`;
            } else {
                // Bank Transfer Form (Your correct form with actual entry IDs)
                formUrl = `https://docs.google.com/forms/d/e/1FAIpQLSdzVs8LdM9G6wEHwIwfxLvwGbEV43ZfK8F_9QXmNbnHpN_G5Q/viewform?usp=pp_url` +
                    `&entry.209098555=${orderId}` +           // Order ID
                    `&entry.701631358=${amount}` +            // Amount
                    `&entry.1509226876=${encodeURIComponent(userEmail)}` +  // Email
                    `&entry.485473134=${encodeURIComponent(userName)}` +    // Name
                    `&entry.2045922923=${new Date().toISOString().split('T')[0]}` + // Date
                    `&entry.4317222=` +                       // UTR Number (empty, user will fill)
                    `&entry.136861828=`;                      // Bank Name (empty, user will fill)
                
                console.log('üè¶ Bank Transfer Form URL with pre-fill:', formUrl);
            }
            
            // Show instructions before opening form
            const instructions = type === 'cheque' ? 
                "üìù CHEQUE PAYMENT INSTRUCTIONS:\n\n" +
                "1. Fill out the form that will open\n" +
                "2. Upload clear images of your CHEQUE\n" +
                "3. Enter cheque number and bank details\n" +
                "4. Submit the form\n" +
                "5. Close the form tab when done\n\n" +
                "Click OK to open the form now." :
                "üè¶ BANK TRANSFER INSTRUCTIONS:\n\n" +
                "1. Fill out the form that will open\n" +
                "2. Upload clear images of your TRANSFER RECEIPT\n" +
                "3. Enter UTR number and bank details\n" +
                "4. Submit the form\n" +
                "5. Close the form tab when done\n\n" +
                "Click OK to open the form now.";
            
            alert(instructions);
            
            // Open form in new window/tab
            const formWindow = window.open(formUrl, '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
            
            // Show immediate redirect option
            setTimeout(() => {
                const redirectNow = confirm(
                    "üìã Form opened successfully!\n\n" +
                    "After you complete and submit the form:\n" +
                    "‚Ä¢ Close the form tab\n" +
                    "‚Ä¢ Click 'OK' here to go to your orders page\n" +
                    "‚Ä¢ Or click 'Cancel' to stay on this page\n\n" +
                    "Ready to go to your orders page?"
                );
                
                if (redirectNow) {
                    window.location.href = `/payment-success.html?orderId=${orderId}&amount=${amount}&type=${type}`;
                }
            }, 2000);
            
            // Also check if form window is closed
            const checkClosed = setInterval(() => {
                if (formWindow.closed) {
                    clearInterval(checkClosed);
                    
                    // Automatic redirect when form is closed
                    setTimeout(() => {
                        window.location.href = `/payment-success.html?orderId=${orderId}&amount=${amount}&type=${type}`;
                    }, 1000);
                }
            }, 1000);
        }
        
        // Make function globally available
        window.openPaymentForm = openPaymentForm;
        
        // Function for manual redirect after form completion
        function redirectToSuccess() {
            const confirmed = confirm(
                "‚úÖ Confirm Form Submission\n\n" +
                "Did you successfully submit the payment form?\n\n" +
                "Click 'OK' if you completed the form submission.\n" +
                "Click 'Cancel' if you still need to fill the form."
            );
            
            if (confirmed) {
                window.location.href = `/payment-success.html?orderId=${orderId}&amount=${amount}&type=${paymentType}`;
            }
        }
        
        window.redirectToSuccess = redirectToSuccess;
    </script>
</body>
</html>